@(user: User, uploadVideoForm: Form[Uploads.UploadVideoForm])

@videoItem(video: Video) = {
    <div>
        <video width="320" height="240" controls>
            <source src="assets/uploads/@(video.id).webm" type='video/webm'>
            <source src="assets/uploads/@(video.id).mp4" type="video/mp4">
            Your browser does not support the HTML5 video.
        </video>
        <h4>@video.title</h4>
        <p>@video.description</p>
        @if(video.user.equals(user)) {
            (<a href="@routes.Uploads.delete(video.id)">Delete</a>)
        }
    </div>
}

@main(user, "uploads") {
    <div class="row-fluid">            
        <div class="span12 well">
            <h4>Upload video</h4>
            <form id="myForm" action="@routes.Uploads.post()" method="post" enctype="multipart/form-data">
                <p><input type="file" name="file" placeholder="Select file"></p>
                <p><input type="text" name="title" placeholder="Title" value="@uploadVideoForm("title").value" maxlength=63></p>
                <p><textarea rows="6" name="description" placeholder="Description" maxlength=255>@uploadVideoForm("description").value</textarea></p>
                <div id="formulas">
                </div>
                <a class="addFormula btn btn-success">Add another formula</a>
                <p><button type="submit" class="btn btn-primary">Upload</button></p>
            </form>
            <div class="formula-template" hidden>
                <a class="removeFormula btn btn-danger pull-right">Remove this formula</a>
                <input type="text" name="conditions[x]" placeholder="Condition formula">
                <input type="text" name="results[x]" placeholder="Payout formula">
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12 well">
            @user.videos.map {video => @videoItem(video)}
        </div>
    </div>
    <script type="text/javascript">
    	$('.removeFormula').on('click', function(e) {
    		$(this).parents('.formula-clone').remove();
    		renumber();
        });
        $('.addFormula').on('click', function(e) {
            $('.formula-template').clone(true).removeClass('formula-template').addClass('formula-clone').appendTo('#formulas').show();
    		renumber();
        });
        $('#myForm').submit(function() {
            $('.formula-template').remove();
        });
        var renumber = function() {
            $('.formula-clone').each(function(i) {
                $('input', this).each(function() {
                	$(this).attr('name', $(this).attr('name').replace(/conditions\[.+?\]/g, 'conditions[' + i + ']'));
                	$(this).attr('name', $(this).attr('name').replace(/results\[.+?\]/g, 'results[' + i + ']'));
            	});
        	});
        }
        
    </script>
}